name: Repo Setup
on:
  workflow_call:
    secrets:
      token:
        required: true
jobs:
  setup:
    if: "${{ (github.event_name == 'push' && contains(github.event.commits[0].message, 'Initial commit')) || github.event_name == 'workflow_dispatch' }}"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: dev
          fetch-depth: 0
      - name: Merge unrelated histories
        run: "git merge origin/main --allow-unrelated-histories"
      - name: Push
        run: "git push"
      - name: Create branch protections
        uses: ndcmsl/repo-setup-action@main
        id: create_branch_protections
        with:
          token: ${{ secrets.token }}
          repo: ${{ github.repository }}
          owner: ${{ github.repository_owner }}
